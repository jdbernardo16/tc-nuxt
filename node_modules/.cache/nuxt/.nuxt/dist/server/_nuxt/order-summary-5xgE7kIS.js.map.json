{"file":"order-summary-5xgE7kIS.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,UAAM,EAAE,OAAO,QAAQ,KAAA,IAAS,SAAS;AACnC,UAAA,EAAE,SAAS,IAAI,QAAQ;AAC7B,UAAM,EAAE,YAAY,YAAY,IAAI,WAAW;AACzC,UAAA,EAAE,EAAE,IAAI,QAAQ;AAEhB,UAAA,QAAQ,IAAkB,IAAI;AACjB,QAAa,MAAM,gBAAgB,MAAM;AAEtD,UAAA,WAAW,IAAa,KAAK;AAC7B,UAAA,eAAe,IAAI,EAAE;AAE3B,UAAM,UAAU,SAAS,MAAA;;AAAM,gBAAC,cAAS,UAAT,mBAAgB;AAAA,KAAK;AACrD,UAAM,gBAAgB,SAAkB,MAAM,SAAS,eAAe;AACtE,UAAM,iBAAiB,SAAkB,MAAM,SAAS,gBAAgB;AACxE,UAAM,sBAAsB,SAAkB,MAAM;;AAAA,0BAAM,UAAN,mBAAa,YAAW,gBAAgB;AAAA,KAAS;AAC/F,UAAA,cAAc,SAAkB,MAAA;;AAAM,cAAC,CAAC,aAAW,WAAM,UAAN,mBAAa,qBAAoB,GAAG;AAAA,KAAC;AACxF,UAAA,oBAAoB,SAAS,MAAM;;AAAA,gCAAM,UAAN,mBAAa,sBAAb,mBAAgC,UAAS;KAAE;AA4CzE,eAAA;AAAA,MACP,QAAQ;AACJ,eAAO,cAAc,QAAQ,EAAE,4BAA4B,IAAI,EAAE,6BAA6B;AAAA,MAAA;AAAA,IAClG,CACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../../../../woonuxt_base/app/pages/order-summary.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { OrderStatusEnum } from '#woo'\n\nconst { query, params, name } = useRoute()\nconst { customer } = useAuth()\nconst { formatDate, formatPrice } = useHelpers()\nconst { t } = useI18n()\n\nconst order = ref<Order | null>(null)\nconst fetchDelay = ref<boolean>(query.fetch_delay === 'true')\nconst delayLength = 2500\nconst isLoaded = ref<boolean>(false)\nconst errorMessage = ref('')\n\nconst isGuest = computed(() => !customer.value?.email)\nconst isSummaryPage = computed<boolean>(() => name === 'order-summary')\nconst isCheckoutPage = computed<boolean>(() => name === 'order-received')\nconst orderIsNotCompleted = computed<boolean>(() => order.value?.status !== OrderStatusEnum.COMPLETED)\nconst hasDiscount = computed<boolean>(() => !!parseFloat(order.value?.rawDiscountTotal || '0'))\nconst downloadableItems = computed(() => order.value?.downloadableItems?.nodes || [])\n\nonBeforeMount(() => {\n    /**\n     * This is to close the child PayPal window we open on the checkout page.\n     * It will fire off an event that redirects the parent window to the order summary page.\n     */\n    if (isCheckoutPage.value && (query.cancel_order || query.from_paypal || query.PayerID)) window.close()\n})\n\nonMounted(async () => {\n    await getOrder()\n    /**\n     * WooCommerce sometimes takes a while to update the order status.\n     * This is a workaround to fetch the order again after a delay.\n     * The length of the delay might need to be adjusted depending on your server.\n     */\n\n    if (isCheckoutPage.value && fetchDelay.value && orderIsNotCompleted.value) {\n        setTimeout(() => {\n            getOrder()\n        }, delayLength)\n    }\n})\n\nasync function getOrder() {\n    try {\n        const data = await GqlGetOrder({ id: params.orderId as string })\n        if (data.order) {\n            order.value = data.order\n        } else {\n            errorMessage.value = 'Could not find order'\n        }\n    } catch (err: any) {\n        errorMessage.value = err?.gqlErrors?.[0].message || 'Could not find order'\n    }\n    isLoaded.value = true\n}\n\nconst refreshOrder = async () => {\n    isLoaded.value = false\n    await getOrder()\n}\n\nuseSeoMeta({\n    title() {\n        return isSummaryPage.value ? t('messages.shop.orderSummary') : t('messages.shop.orderReceived')\n    },\n})\n</script>\n\n<template>\n    <div\n        class=\"w-full min-h-[600px] flex items-center p-4 text-gray-800 md:bg-white md:rounded-xl md:mx-auto md:shadow-lg md:my-24 md:mt-8 md:max-w-3xl md:p-16 flex-col\"\n    >\n        <LoadingIcon\n            v-if=\"!isLoaded\"\n            class=\"flex-1\"\n        />\n        <template v-else>\n            <div\n                v-if=\"order\"\n                class=\"w-full\"\n            >\n                <template v-if=\"isSummaryPage\">\n                    <div class=\"flex items-center gap-4\">\n                        <NuxtLink\n                            to=\"/my-account?tab=orders\"\n                            class=\"inline-flex items-center justify-center p-2 border rounded-md\"\n                            title=\"Back to orders\"\n                            aria-label=\"Back to orders\"\n                        >\n                            <Icon name=\"ion:chevron-back-outline\" />\n                        </NuxtLink>\n                        <h1 class=\"text-xl font-semibold\">{{ $t('messages.shop.orderSummary') }}</h1>\n                    </div>\n                </template>\n                <template v-else-if=\"isCheckoutPage\">\n                    <div class=\"flex items-center justify-between w-full mb-2\">\n                        <h1 class=\"text-xl font-semibold\">{{ $t('messages.shop.orderReceived') }}</h1>\n                        <button\n                            v-if=\"orderIsNotCompleted\"\n                            type=\"button\"\n                            class=\"inline-flex items-center justify-center p-2 bg-white border rounded-md\"\n                            title=\"Refresh order\"\n                            aria-label=\"Refresh order\"\n                            @click=\"refreshOrder\"\n                        >\n                            <Icon name=\"ion:refresh-outline\" />\n                        </button>\n                    </div>\n                    <p>{{ $t('messages.shop.orderThanks') }}</p>\n                </template>\n                <hr class=\"my-8\" />\n            </div>\n            <div\n                v-if=\"order && !isGuest\"\n                class=\"flex-1 w-full\"\n            >\n                <div class=\"flex items-start justify-between\">\n                    <div class=\"w-[21%]\">\n                        <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.shop.order') }}</div>\n                        <div class=\"leading-none\">#{{ order.databaseId! }}</div>\n                    </div>\n                    <div class=\"w-[21%]\">\n                        <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.general.date') }}</div>\n                        <div class=\"leading-none\">{{ formatDate(order.date) }}</div>\n                    </div>\n                    <div class=\"w-[21%]\">\n                        <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.general.status') }}</div>\n                        <OrderStatusLabel\n                            v-if=\"order.status\"\n                            :order=\"order\"\n                        />\n                    </div>\n                    <div class=\"w-[21%]\">\n                        <div class=\"mb-2 text-xs text-gray-400 uppercase\">\n                            {{ $t('messages.general.paymentMethod') }}\n                        </div>\n                        <div class=\"leading-none\">{{ order.paymentMethodTitle }}</div>\n                    </div>\n                </div>\n\n                <template v-if=\"order.lineItems\">\n                    <hr class=\"my-8\" />\n\n                    <div class=\"grid gap-2\">\n                        <div\n                            v-for=\"item in order.lineItems.nodes\"\n                            :key=\"item.id\"\n                            class=\"flex items-center justify-between gap-8\"\n                        >\n                            <NuxtLink\n                                v-if=\"item.product?.node\"\n                                :to=\"`/product/${item.product.node.slug}`\"\n                            >\n                                <NuxtImg\n                                    class=\"w-16 h-16 rounded-xl\"\n                                    :src=\"\n                                        item.variation?.node?.image?.sourceUrl ||\n                                        item.product.node?.image?.sourceUrl ||\n                                        '/images/placeholder.png'\n                                    \"\n                                    :alt=\"\n                                        item.variation?.node?.image?.altText ||\n                                        item.product.node?.image?.altText ||\n                                        'Product image'\n                                    \"\n                                    :title=\"\n                                        item.variation?.node?.image?.title ||\n                                        item.product.node?.image?.title ||\n                                        'Product image'\n                                    \"\n                                    width=\"64\"\n                                    height=\"64\"\n                                    loading=\"lazy\"\n                                />\n                            </NuxtLink>\n                            <div class=\"flex-1 leading-tight\">\n                                {{ item.variation ? item.variation?.node?.name : item.product?.node.name! }}\n                            </div>\n                            <div class=\"text-sm text-gray-600\">Qty. {{ item.quantity }}</div>\n                            <span class=\"text-sm font-semibold\">{{ formatPrice(item.total!) }}</span>\n                        </div>\n                    </div>\n                </template>\n\n                <hr class=\"my-8\" />\n\n                <div v-if=\"downloadableItems.length && !orderIsNotCompleted\">\n                    <DownloadableItems :downloadableItems=\"downloadableItems\" />\n                    <hr class=\"my-8\" />\n                </div>\n\n                <div>\n                    <div class=\"flex justify-between\">\n                        <span>{{ $t('messages.shop.subtotal') }}</span>\n                        <span>{{ order.subtotal }}</span>\n                    </div>\n                    <div class=\"flex justify-between\">\n                        <span>{{ $t('messages.general.tax') }}</span>\n                        <span>{{ order.totalTax }}</span>\n                    </div>\n                    <div class=\"flex justify-between\">\n                        <span>{{ $t('messages.general.shipping') }}</span>\n                        <span>{{ order.shippingTotal }}</span>\n                    </div>\n                    <div\n                        v-if=\"hasDiscount\"\n                        class=\"flex justify-between text-primary\"\n                    >\n                        <span>{{ $t('messages.shop.discount') }}</span>\n                        <span>- {{ order.discountTotal }}</span>\n                    </div>\n                    <hr class=\"my-8\" />\n                    <div class=\"flex justify-between\">\n                        <span class>{{ $t('messages.shop.total') }}</span>\n                        <span class=\"font-semibold\">{{ order.total }}</span>\n                    </div>\n                </div>\n            </div>\n            <div\n                v-else-if=\"errorMessage\"\n                class=\"flex flex-col items-center justify-center flex-1 w-full gap-4 text-center\"\n            >\n                <Icon\n                    name=\"ion:sad-outline\"\n                    size=\"96\"\n                    class=\"text-gray-700\"\n                />\n                <h1 class=\"text-xl font-semibold\">Error</h1>\n                <div\n                    v-if=\"errorMessage\"\n                    class=\"text-sm text-red-500\"\n                    v-html=\"errorMessage\"\n                />\n            </div>\n        </template>\n    </div>\n</template>\n"],"version":3}