import { Awaitable } from '@antfu/utils';
import { Node } from '@babel/types';
import { MagicStringAST } from 'magic-string-ast';

interface TransformerParsed {
    transformer: Transformer;
    nodes: {
        node: NodeRef<Node | undefined>;
    }[];
}
interface NodeRef<T = Node> {
    value: T;
    set: (node: T) => void;
}
interface Transformer<T extends Node = Node> {
    transformInclude?: (id: string) => Awaitable<boolean>;
    onNode?: ((node: Node, parent: Node | null | undefined, index: number | null | undefined) => Awaitable<boolean>) | ((node: Node, parent: Node | null | undefined, index: number | null | undefined) => node is T);
    transform: (node: T, code: string, context: {
        id: string;
    }) => Awaitable<string | Node | false | undefined | null>;
    finalize?: (s: MagicStringAST) => Awaitable<void>;
}

export type { NodeRef as N, Transformer as T, TransformerParsed as a };
